{% extends "base.html" %}
{% block style %}
<style>
    hr {
        margin-top: 0rem;
        margin-bottom: 0rem;
    }
</style>
{% endblock %}
{% block content %}
<body data-spy="scroll" data-target=".navbar" data-offset="50">
    <div class="container-fluid" style="padding-left: 0px;padding-right: 0px;">
        <nav class="navbar  bg-secondary navbar-dark navbar-expand-sm fixed-top">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link " href="#section1">基本信息</a>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="#section2">密码重置</a>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="#section3">更换密保邮箱</a>
          </li>
        </ul>
    </nav>


<div id="section1" class="container-fluid bg-light " style="padding-top:70px;padding-bottom:70px">
        <h3>基本信息</h3>
            <form action="/fbyysite/accountmanage"  method="post" style="width:20em;">
            <div class="form-group">
                <input type="hidden" name="userid"  value="{{user.idtb_user_info}}">
            </div>
            <div class="form-group">
                <input type="hidden" name="refererurl"  value="{{refererurl}}">
            </div>
            <div class="form-group">
                {{ form.username.errors }}
                <label for="id_username">用户名:</label>
                <input type="text" name="username" placeholder="请输入真实姓名" class="form-control" maxlength="20" required="" id="id_username" value="{{user.tb_user_info_name}}" readonly="readonly">
            </div>
            <div class="form-group">
                {{ form.usernickname.errors }}
              <label for="id_usernickname">用户花名:</label>
              <input type="text" name="usernickname" placeholder="请输入公司内部花名" class="form-control" maxlength="20" required="" id="id_usernickname" value="{{user.tb_user_info_nickname}}" >
            </div>
            <div class="form-group">

            <label >是否为超级管理员:</label><br>
            {% ifequal user.tb_user_info_issuperuser 1 %}
                <label class="text-muted" >超级管理员</label>
            {% else %}
               <label class="text-muted" >非超级管理员</label>
            {% endifequal %}
            </div>
            <div class="form-group">

            <label >账号激活状态:</label><br>
            {% ifequal user.tb_user_info_isactive 1 %}
                <label class="text-muted">激活</label>
            {% else %}
                <label class="text-muted" >非激活</label>
            {% endifequal %}
            </div>
            <div class="form-group">
                {{ form.seldepart.errors }}
            <label for="seldepart">所在部门:</label>
            <select class="form-control" id="seldepart" name="seldepart">
              <option value=''>请选择部门</option>
              {% for department in departments %}
                {% ifequal department.tb_department_info_code user.tb_user_info_department_code %}
                  <option value={{ department.tb_department_info_code }} selected="selected">{{ department.tb_department_info_name }}</option>
                {% else %}
                  <option value={{ department.tb_department_info_code }}>{{ department.tb_department_info_name }}</option>
                {% endifequal %}
              {% endfor %}
            </select>
            </div>
            <div class="form-group">
                {{ form.selstore.errors }}
                <label for="selstore">所在店铺:</label>
                <select class="form-control" id="selstore" name="selstore">
                </select>
            </div>
                <input type="submit" class="btn btn-primary" value="确认修改">
        </form>
        <script>
  $(".errorlist").addClass("list-group")
  $(".errorlist li").addClass("list-group-item-danger")

  var depart_code = $("#seldepart").val();
if(depart_code===''){
$('#selstore').empty();
}else{
      $.ajax({
        url: '/fbyysite/registe/ajaxstores',
        data: {
          'depart_code': depart_code
        },
        type: 'GET',
        dataType: 'json',
        success: function (data) {
                  $('#selstore').empty();
            var content='<option value='+'Other'+'>非店铺</option>';
            $.each($.parseJSON(data), function(i, item){
                           if(item.fields.tb_store_code === '{{user.tb_user_info_store_code}}'){
                           content+='<option value='+item.fields.tb_store_code+' selected="selected">'+item.fields.tb_store_code+'</option>'
                           }else{
                           content+='<option value='+item.fields.tb_store_code+'>'+item.fields.tb_store_code+'</option>'
                           }
                  
                });
            $('#selstore').html(content)
        },
      });
}
$("#seldepart").change(function() {
      var depart_code = $("#seldepart").val();
         if(depart_code===''){
            $('#selstore').empty();
         }else{
            $.ajax({
        url: '/fbyysite/registe/ajaxstores',
        data: {
          'depart_code': depart_code
        },
        type: 'GET',
        dataType: 'json',
        success: function (data) {
                   $('#selstore').empty();
            var content='<option value='+'Other'+'>非店铺</option>';
            $.each($.parseJSON(data), function(i, item){
                  content+='<option value='+item.fields.tb_store_code+'>'+item.fields.tb_store_code+'</option>'
                });
            $('#selstore').html(content)
        },

      });
         }
      
    });

</script>
    </div>
        <hr >
    <div id="section2" class="container-fluid bg-light" style="padding-top:70px;padding-bottom:70px">
      <h3>密码重置</h3>
      <form action="/fbyysite/accountpswchange" method="post">
           <div class="form-group">
                <input type="hidden" name="resetpwdemail"  value="{{user.tb_user_info_email}}">
            </div>
            <input type="submit" class="btn btn-primary" value="修改密码"><span class="alert alert-warning ml-2"><label >将发送修改密码邮件，请确认当前密保邮箱可用</label></span>
      </form>
    </div>
        <hr >
    <div id="section3" class="container-fluid bg-light" style="padding-top:70px;padding-bottom:70px">
      <h3>更换密保邮箱</h3>
      <form action="/fbyysite/accountemailchange" method="post">
           <div class="form-group">
                <input type="hidden" name="userid"  value="{{user.idtb_user_info}}">
            </div>
            <input type="submit" class="btn btn-primary" value="更换密保邮箱">
      </form>
    </div>


    </div>



</body>
{% endblock %}