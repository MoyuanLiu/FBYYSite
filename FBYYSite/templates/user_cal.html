{% extends "base.html" %}
{% block style %}
<style>
	.axis path,
	.axis line{
		fill: none;
		stroke: black;
		shape-rendering: crispEdges;
	}

	.axis text {
		font-family: sans-serif;
		font-size: 11px;
	}

	.MyRect {

	}

	.MyText {
		fill: white;
		text-anchor: middle;
	}
</style>
{% endblock %}
{% block script %}
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

{% endblock %}

{% block content %}
<body>
    <div class="container-fluid d-inline-flex d-flex justify-content-between">
        <div class="p-2">
            <h2>用户统计看板</h2>
        </div>
        <div class="btn-group p-3 text-center">
            <a class="btn btn-success text-white ml-auto" href="/fbyysite/usermanage/pagenum/1"><i class="fa fa-mail-reply fa-lg"></i>返回</a>
        </div>
    </div>
    <hr>
    <div class="container-fluid" style="margin-top:30px">
        <div class="d-flex">
            <table>
                <tbody>
                    <tr>
                        <td>
                            <div class="card text-center" style="width:300px;height:300px">
                                <div class="card-body m-auto " >
                                    <h2 class="card-title">当前用户总数：</h2><br/>
                                    <h1 class="display-1"><strong class="text-danger font-weight-bold">{{usercount}}</strong><small class="small">人</small></h1>
                                 </div>
                            </div>
                        </td>
                        <td>
                            <div class="card text-center" style="width:350px;height:300px">
                                <div id="userstorepic" class="card-body m-auto " style="justify-content: center;">
                                    <h6 class="card-title">用户店铺分布图：</h6>
                                 </div>
                            </div>
                        </td>
                        <td>
                            <div class="card text-center" style="width:350px;height:300px">
                                <div id="userrolepic" class="card-body m-auto " style="justify-content: center;">
                                    <h6 class="card-title">用户角色占比图：</h6>
                                 </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>


        </div>

    </div>
<script>
    var width = 350;
	var height = 250;
	var svg = d3.select("#userstorepic")
	    .append("svg")
	    .attr("width",width)
	    .attr("height",height);
	var padding = {left:30, right:30, top:20, bottom:20}
	var dataset = {{storeusers|safe}}
	var keyset = {{userstores|safe}}
	var xScale = d3.scale.ordinal()
	    .domain(d3.range(keyset.length))
	    .rangeRoundBands([0,width-padding.left-padding.right]);
	var xtextScale = d3.scale.ordinal()
	    .domain(keyset)
	    .rangeRoundBands([0,width-padding.left-padding.right]);
	var yScale = d3.scale.linear()
	    .domain([0,d3.max(dataset)])
	    .range([height-padding.top - padding.bottom,0]);
	var xAxis = d3.svg.axis()
	    .scale(xtextScale)
	    .orient("bottom");
	var yAxis = d3.svg.axis()
	    .scale(yScale)
	    .orient("left");
	var rectPadding = 4;
	var rects = svg.selectAll(".MyRect")
	    .data(dataset)
	    .enter()
	    .append("rect")
	    .attr("class","MyRect")
	    .attr("transform","translate(" + padding.left + "," + padding.top + ")")
	    .attr("x",function(d,i){
	        return xScale(i) + rectPadding/2;
	    })
	    .attr("y",function(d){
	        return yScale(d);
	    })
	    .attr("width",xScale.rangeBand() - rectPadding)
	    .attr("height",function(d){
	        return height - padding.top - padding.bottom - yScale(d);
	    })
	    .attr("fill","steelblue")
	    .on("mouseover",function(d,i){
	        d3.select(this).attr("fill","yellow");
	    })
	    .on("mouseout",function(d,i){
	        d3.select(this)
				.transition()
		        .duration(500)
				.attr("fill","steelblue");
	    });
	    var texts = svg.selectAll(".MyText")
	        .data(dataset)
	        .enter()
	        .append("text")
	        .attr("class","MyText")
	        .attr("transform","translate(" + padding.left + "," + padding.top + ")")
	        .attr("x",function(d,i){
	            return xScale(i) + rectPadding/2;
	        })
	        .attr("y",function(d){
	            return yScale(d);
	        })
	        .attr("dx",function(){
	            return (xScale.rangeBand() - rectPadding)/2;
	        })
	        .attr("dy",function(d){
	            return 20;
	        })
	        .text(function(d){
	            return d;
	        });
	    svg.append("g")
	        .attr("class","axis")
	        .attr("transform","translate(" + padding.left + "," + (height-padding.bottom)+")")
	        .call(xAxis);
	    svg.append("g")
	        .attr("class","axis")
	        .attr("transform","translate(" + padding.left + "," + padding.top + ")")
	        .call(yAxis);

	
</script>

</body>

{% endblock %}
