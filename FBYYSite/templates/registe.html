{% extends "base_login.html" %}

{% block title %}注册用户{% endblock %}
{% block script %}

{% endblock %}

{% block main %}
<div class="container" style="margin-top:100px; width:40em;">
    {% if form.errors %}
        <p class="text-danger">
            请修改以下标出的错误
        </p>
    {% endif %}
  <form action="" method="post">
    {% csrf_token %}
    <div class="form-group">
      {{ form.username.errors }}
      <label for="id_username">用户名:</label>
      {{ form.username }}
    </div>
    <div class="form-group">
      {{ form.usernickname.errors }}
      <label for="id_usernickname">用户花名:</label>
      {{ form.usernickname }}

    </div>
    <div class="form-group">
      {{ form.pwd.errors }}
      <label for="id_pwd">密码:</label>
      {{ form.pwd }}

    </div>
    <div class="form-group">
      {{ form.confirmpwd.errors }}
      <label for="id_confirmpwd">确认密码:</label>
      {{ form.confirmpwd }}
    </div>
    <div class="form-group">
      {{ form.email.errors }}
      <label for="id_email">邮箱:</label>
      {{ form.email }}
    </div>
    <div class="form-group">
      {{ form.seldepart.errors }}
      <label for="seldepart">所在部门:</label>
      <select class="form-control" id="seldepart" name="seldepart">
        <option value=''>请选择部门</option>
        {% for department in departments %}
        <option value={{ department.tb_department_info_code }}>{{ department.tb_department_info_name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="form-group">
      {{ form.selstore.errors }}
      <label for="selstore">所在店铺:</label>
      <select class="form-control" id="selstore" name="selstore">
      </select>
    </div>
    <input type="submit" class="btn btn-primary" value="Submit">
  </form>
  <script>
  $(".errorlist").addClass("list-group")
  $(".errorlist li").addClass("list-group-item-danger")

  var depart_code = $("#seldepart").val();
if(depart_code===''){

}else{
      $.ajax({
        url: 'registe/ajaxstores',
        data: {
          'depart_code': depart_code
        },
        type: 'GET',
        dataType: 'json',
        success: function (data) {
            var content='<option value='+'Other'+'>非店铺</option>';
            $.each($.parseJSON(data), function(i, item){
                  content+='<option value='+item.fields.tb_store_code+'>'+item.fields.tb_store_code+'</option>'
                });
            $('#selstore').html(content)
        },
      });
}
$("#seldepart").change(function() {
      var depart_code = $(this).val();
      $.ajax({
        url: 'registe/ajaxstores',
        data: {
          'depart_code': depart_code
        },
        type: 'GET',
        dataType: 'json',
        success: function (data) {
            var content='<option value='+'Other'+'>非店铺</option>';
            $.each($.parseJSON(data), function(i, item){
                  content+='<option value='+item.fields.tb_store_code+'>'+item.fields.tb_store_code+'</option>'
                });
            $('#selstore').html(content)
        },

      });
    });

</script>
</div>
{% endblock %}